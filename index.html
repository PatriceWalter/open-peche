<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OPEN 2026</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f1f5f9; }
        .modal-overlay { background-color: rgba(30, 58, 138, 0.4); backdrop-filter: blur(3px); }
    </style>
</head>
<body>

    <div id="app" class="max-w-6xl mx-auto p-4 md:p-8"></div>

    <!-- Modal Attribution Poste -->
    <div id="modal-poste" class="hidden fixed inset-0 modal-overlay flex items-center justify-center z-50">
        <div class="bg-white p-8 rounded-3xl shadow-2xl w-full max-w-sm mx-4 border-t-8 border-blue-600">
            <h3 class="text-xl font-bold mb-2 text-blue-900 uppercase italic">Assigner un poste</h3>
            <p id="modal-fisher-name" class="text-blue-600 font-bold mb-2 text-lg"></p>
            <p id="modal-fisher-secteur" class="text-xs text-slate-500 mb-6 uppercase"></p>
            <select id="modal-select-poste" class="w-full border-2 border-slate-100 p-4 rounded-2xl mb-6 font-bold outline-none focus:border-blue-600 bg-slate-50 uppercase"></select>
            <div class="flex gap-3">
                <button onclick="closePosteModal()" class="flex-1 bg-slate-100 py-4 rounded-2xl font-bold text-slate-500">Annuler</button>
                <button onclick="confirmPosteAssignment()" class="flex-1 bg-blue-600 py-4 rounded-2xl font-bold text-white uppercase italic">Valider</button>
            </div>
        </div>
    </div>

    <script>
        // Configuration Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBKcwgVSkqAfOl0C7ywpS4sKbDPpcsrnmw",
            authDomain: "enduro-gundershoffen.firebaseapp.com",
            projectId: "enduro-gundershoffen",
            appId: "1:957498107874:web:f4e2d4e8c8e9e8e8e8e8e8"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        let state = {
            isLoggedIn: sessionStorage.getItem('auth_open2026') === 'true',
            isAdmin: false,
            currentPage: 'index',
            currentDay: 1,
            currentPoste: null,
            currentSecteur: null,
            fishermen: [],
            contestInfo: { 
                title: 'OPEN 2026', 
                dateJ1: '26 Septembre 2026',
                dateJ2: '27 Septembre 2026'
            }
        };

        // √âcoute Firebase
        db.collection("data").doc("open-2026").onSnapshot(doc => {
            if(doc.exists) {
                const d = doc.data();
                state.fishermen = d.fishermen || [];
                state.contestInfo = d.contestInfo || state.contestInfo;
                render();
            }
        });

        const save = async () => {
            await db.collection("data").doc("open-2026").set({ 
                fishermen: state.fishermen, 
                contestInfo: state.contestInfo 
            });
        };

        // Authentification
        window.login = () => {
            const id = document.getElementById('l_id').value;
            const mdp = document.getElementById('l_mdp').value;
            if(id === "aappma" && mdp === "911") {
                state.isLoggedIn = true;
                sessionStorage.setItem('auth_open2026', 'true');
                render();
            } else { 
                alert("Erreur identifiants"); 
            }
        };

        window.logout = () => {
            state.isLoggedIn = false;
            state.isAdmin = false;
            sessionStorage.removeItem('auth_open2026');
            render();
        };

        window.checkAdmin = () => {
            const p = prompt("Mot de passe admin :");
            if(p === "admin") { 
                state.isAdmin = true; 
                nav('settings'); 
            } else { 
                alert("Acc√®s refus√©");
            }
        };

        // Calculs
        const calc = {
            // Poids total d'un p√™cheur pour un jour donn√©
            dayWeight: (f, day) => (f.weights || []).filter(w => w.day === day).reduce((s, w) => s + w.weight, 0),
            
            // Poids total des 2 jours
            totalWeight: (f) => (f.weights || []).reduce((s, w) => s + w.weight, 0),
            
            // Nombre de poissons pour un jour
            dayFishCount: (f, day) => (f.weights || []).filter(w => w.day === day).reduce((s, w) => s + (w.fishCount || 0), 0),
            
            // Nombre total de poissons
            totalFishCount: (f) => (f.weights || []).reduce((s, w) => s + (w.fishCount || 0), 0),
            
            // Poids global par jour
            globalDayWeight: (day) => state.fishermen.reduce((acc, f) => acc + calc.dayWeight(f, day), 0),
            
            // Poissons global par jour
            globalDayFish: (day) => state.fishermen.reduce((acc, f) => acc + calc.dayFishCount(f, day), 0),
            
            // Record du jour (plus grosse prise unique)
            dayRecord: (day) => {
                let best = { w: 0, n: '---', p: '' };
                state.fishermen.forEach(f => {
                    (f.weights || []).filter(w => w.day === day).forEach(w => {
                        if(w.fishCount === 1 && w.weight > best.w) {
                            best = { w: w.weight, n: f.nom, p: f.prenom };
                        }
                    });
                });
                return best;
            },
            
            // Record g√©n√©ral
            globalRecord: () => {
                let best = { w: 0, n: '---', p: '' };
                state.fishermen.forEach(f => {
                    (f.weights || []).forEach(w => {
                        if(w.fishCount === 1 && w.weight > best.w) {
                            best = { w: w.weight, n: f.nom, p: f.prenom };
                        }
                    });
                });
                return best;
            }
        };

        window.nav = (p) => { 
            state.currentPage = p; 
            render();
        };

        window.setDay = (d) => {
            state.currentDay = d;
            render();
        };

        // Rendu principal
        function render() {
            const root = document.getElementById('app');
            
            // Page de connexion
            if(!state.isLoggedIn) {
                root.innerHTML = `
                    <div class="min-h-[60vh] flex items-center justify-center">
                        <div class="bg-white p-10 rounded-[2.5rem] shadow-xl w-full max-w-sm mx-4 border text-center">
                            <h2 class="text-2xl font-black mb-6 text-blue-900 uppercase italic">Connexion</h2>
                            <input id="l_id" value="aappma" readonly class="w-full p-4 border rounded-2xl mb-4 font-bold bg-slate-200 uppercase outline-none cursor-not-allowed text-slate-600">
                            <input id="l_mdp" type="password" placeholder="MOT DE PASSE" class="w-full p-4 border rounded-2xl mb-6 font-bold bg-slate-50 outline-none">
                            <button onclick="login()" class="w-full bg-blue-600 text-white font-black py-4 rounded-2xl shadow-lg uppercase italic">Entrer</button>
                        </div>
                    </div>`;
                return;
            }

            // Pages principales
            if(state.currentPage === 'index') renderIndex(root);
            else if(state.currentPage === 'inscription') renderInscription(root);
            else if(state.currentPage === 'attributionJ1') renderAttributionJ1(root);
            else if(state.currentPage === 'attributionJ2') renderAttributionJ2(root);
            else if(state.currentPage === 'resultats') renderResultats(root);
            else if(state.currentPage === 'poste') renderPoste(root);
            else if(state.currentPage === 'settings') renderSettings(root);
            
            lucide.createIcons();
        }

        // Page d'accueil
        function renderIndex(container) {
            container.innerHTML = `
                <div class="flex justify-between items-center mb-8">
                    <button onclick="checkAdmin()" class="p-3 bg-white border rounded-full text-blue-600 shadow-sm hover:bg-blue-50 transition-colors">
                        <i data-lucide="settings"></i>
                    </button>
                    <button onclick="logout()" class="p-3 bg-red-50 border border-red-100 rounded-full text-red-600 shadow-sm hover:bg-red-100 transition-colors">
                        <i data-lucide="log-out"></i>
                    </button>
                </div>
                
                <div class="text-center mb-12">
                    <h1 class="text-5xl font-black text-blue-900 uppercase italic tracking-tighter">${state.contestInfo.title}</h1>
                    <div class="inline-block px-8 py-3 bg-blue-600 text-white rounded-full font-bold uppercase text-xs mt-3 shadow-lg">
                        ${state.contestInfo.dateJ1} - ${state.contestInfo.dateJ2}
                    </div>
                </div>
                
                <!-- S√©lecteur de jour -->
                <div class="flex justify-center gap-4 mb-8">
                    <button onclick="setDay(1)" class="px-8 py-4 rounded-2xl font-black uppercase italic transition-all ${state.currentDay === 1 ? 'bg-blue-900 text-white shadow-xl scale-105' : 'bg-white text-blue-900 border-2 border-blue-200'}">
                        Jour 1 - ${state.contestInfo.dateJ1}
                    </button>
                    <button onclick="setDay(2)" class="px-8 py-4 rounded-2xl font-black uppercase italic transition-all ${state.currentDay === 2 ? 'bg-blue-900 text-white shadow-xl scale-105' : 'bg-white text-blue-900 border-2 border-blue-200'}">
                        Jour 2 - ${state.contestInfo.dateJ2}
                    </button>
                </div>
                
                <!-- Boutons principaux -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12 max-w-4xl mx-auto">
                    <button onclick="nav('inscription')" class="p-8 bg-orange-500 text-white rounded-[2.5rem] shadow-xl font-black text-2xl flex items-center justify-between hover:scale-95 transition-transform italic">
                        Inscriptions <i data-lucide="users"></i>
                    </button>
                    <button onclick="nav('${state.currentDay === 1 ? 'attributionJ1' : 'attributionJ2'}')" class="p-8 bg-purple-600 text-white rounded-[2.5rem] shadow-xl font-black text-2xl flex items-center justify-between hover:scale-95 transition-transform italic">
                        Postes J${state.currentDay} <i data-lucide="map-pin"></i>
                    </button>
                    <button onclick="nav('resultats')" class="p-8 bg-emerald-600 text-white rounded-[2.5rem] shadow-xl font-black text-3xl flex items-center justify-between hover:scale-95 transition-transform italic">
                        R√©sultats <i data-lucide="trophy"></i>
                    </button>
                </div>
                
                <!-- Grilles des postes -->
                <h2 class="text-2xl font-black text-red-600 mb-4 uppercase italic pl-2 flex items-center gap-2">
                    <span class="w-4 h-4 bg-red-600 rounded-full"></span> Carpodrome - Jour ${state.currentDay}
                </h2>
                <div class="grid grid-cols-2 sm:grid-cols-4 md:grid-cols-7 gap-4 mb-12">
                    ${renderGrid(7, 'carpodrome', state.currentDay)}
                </div>
                
                <h2 class="text-2xl font-black text-emerald-600 mb-4 uppercase italic pl-2 flex items-center gap-2">
                    <span class="w-4 h-4 bg-emerald-600 rounded-full"></span> Grand √âtang - Jour ${state.currentDay}
                </h2>
                <div class="grid grid-cols-2 sm:grid-cols-4 md:grid-cols-7 gap-4">
                    ${renderGrid(7, 'grand-etang', state.currentDay)}
                </div>
            `;
        }

        // Grille des postes
        function renderGrid(count, secteur, day) {
            const secteurKey = day === 1 ? 'secteurJ1' : 'secteurJ2';
            const posteKey = day === 1 ? 'posteJ1' : 'posteJ2';
            
            return Array.from({length: count}, (_, i) => i + 1).map(n => {
                const f = state.fishermen.find(x => x[posteKey] == n && x[secteurKey] === secteur);
                const bgColor = secteur === 'carpodrome' ? 'bg-red-700 border-red-700' : 'bg-emerald-700 border-emerald-700';
                
                return `
                    <button onclick="${f ? `window.openP(${n}, '${secteur}', ${day})` : ''}" 
                        class="p-5 rounded-3xl border-2 transition-all flex flex-col items-center ${f ? bgColor + ' text-white shadow-xl' : 'bg-white border-white text-slate-400 opacity-80'}">
                        <span class="text-[10px] font-black uppercase opacity-50">Poste</span>
                        <span class="text-3xl font-black mb-1 italic">${n}</span>
                        <span class="text-[9px] font-bold uppercase truncate w-full text-center leading-tight">
                            ${f ? `${f.nom}<br><span class="opacity-60 text-[8px] italic">${f.prenom}</span>` : 'LIBRE'}
                        </span>
                    </button>`;
            }).join('');
        }

        window.openP = (n, secteur, day) => { 
            state.currentPoste = n;
            state.currentSecteur = secteur;
            state.currentDay = day;
            nav('poste'); 
        };

        // Page Inscription
        function renderInscription(container) {
            container.innerHTML = `
                <button onclick="nav('index')" class="mb-8 flex items-center text-blue-600 font-bold underline italic">
                    <i data-lucide="arrow-left" class="mr-2"></i> Retour Accueil
                </button>
                
                <div class="bg-white p-8 rounded-[2.5rem] shadow-xl border mb-10">
                    <h2 class="text-2xl font-black text-blue-900 uppercase mb-6 italic">Inscription des P√™cheurs</h2>
                    <p class="text-slate-500 mb-6 text-sm">Inscrivez les 14 p√™cheurs. L'attribution des postes se fera ensuite via le tirage au sort.</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                        <input id="in_nom" placeholder="NOM" class="p-4 border-2 border-slate-100 rounded-2xl font-bold uppercase bg-slate-50 outline-none focus:border-blue-600">
                        <input id="in_prenom" placeholder="Pr√©nom" class="p-4 border-2 border-slate-100 rounded-2xl font-bold bg-slate-50 outline-none focus:border-blue-600">
                        <button onclick="addF()" class="bg-blue-900 text-white font-black py-4 rounded-2xl shadow-xl uppercase italic">
                            Inscrire
                        </button>
                    </div>
                    
                    <div class="bg-blue-50 p-4 rounded-2xl text-center">
                        <span class="text-3xl font-black text-blue-900">${state.fishermen.length}</span>
                        <span class="text-blue-600 font-bold"> / 14 inscrits</span>
                    </div>
                </div>
                
                <div class="bg-white p-8 rounded-[2.5rem] shadow-xl border">
                    <h3 class="font-black text-blue-900 uppercase mb-6 text-lg italic">Liste des Participants</h3>
                    <div class="space-y-3">
                        ${state.fishermen.map((f, idx) => `
                            <div class="bg-slate-50 p-5 rounded-2xl flex justify-between items-center">
                                <div>
                                    <span class="font-black text-blue-900 uppercase text-lg italic">${f.nom} ${f.prenom}</span>
                                    <div class="text-xs text-slate-400 mt-1">
                                        ${f.posteJ1 ? `<span class="bg-red-100 text-red-600 px-2 py-1 rounded mr-2">J1: ${f.secteurJ1 === 'carpodrome' ? 'Carpo' : '√âtang'} P${f.posteJ1}</span>` : ''}
                                        ${f.posteJ2 ? `<span class="bg-emerald-100 text-emerald-600 px-2 py-1 rounded">J2: ${f.secteurJ2 === 'carpodrome' ? 'Carpo' : '√âtang'} P${f.posteJ2}</span>` : ''}
                                    </div>
                                </div>
                                <button onclick="delF(${idx})" class="text-red-300 hover:text-red-500 transition-colors">
                                    <i data-lucide="trash-2"></i>
                                </button>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        window.addF = () => {
            const nom = document.getElementById('in_nom').value.toUpperCase().trim();
            const prenom = document.getElementById('in_prenom').value.trim();
            if(!nom || !prenom) return alert("Veuillez remplir le nom et pr√©nom");
            if(state.fishermen.length >= 14) return alert("Maximum 14 participants atteint");
            if(state.fishermen.find(f => f.nom === nom && f.prenom === prenom)) return alert("Ce p√™cheur existe d√©j√†");
            
            state.fishermen.push({ 
                nom, 
                prenom, 
                secteurJ1: null, 
                posteJ1: null,
                secteurJ2: null,
                posteJ2: null,
                weights: [] 
            });
            save();
            document.getElementById('in_nom').value = '';
            document.getElementById('in_prenom').value = '';
        };

        window.delF = (idx) => { 
            if(confirm("Supprimer ce p√™cheur ?")) { 
                state.fishermen.splice(idx, 1);
                save(); 
            } 
        };

        // Attribution J1
        function renderAttributionJ1(container) {
            const carpoAssigned = state.fishermen.filter(f => f.secteurJ1 === 'carpodrome' && f.posteJ1);
            const etangAssigned = state.fishermen.filter(f => f.secteurJ1 === 'grand-etang' && f.posteJ1);
            const waiting = state.fishermen.filter(f => !f.posteJ1);
            
            container.innerHTML = `
                <button onclick="nav('index')" class="mb-8 flex items-center text-blue-600 font-bold underline italic">
                    <i data-lucide="arrow-left" class="mr-2"></i> Retour Accueil
                </button>
                
                <div class="bg-white p-8 rounded-[2.5rem] shadow-xl border mb-8">
                    <h2 class="text-2xl font-black text-blue-900 uppercase mb-2 italic">Attribution Jour 1</h2>
                    <p class="text-slate-500 text-sm">${state.contestInfo.dateJ1} - Apr√®s le tirage au sort, assignez chaque p√™cheur √† son secteur et poste.</p>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                    <!-- Carpodrome -->
                    <div>
                        <h3 class="font-black text-red-600 uppercase mb-4 bg-red-50 p-4 rounded-xl text-xs italic tracking-widest flex items-center gap-2">
                            <span class="w-3 h-3 bg-red-600 rounded-full"></span> Carpodrome (${carpoAssigned.length}/7)
                        </h3>
                        <div class="space-y-3">
                            ${carpoAssigned.sort((a,b) => a.posteJ1 - b.posteJ1).map(f => `
                                <div class="bg-white p-5 rounded-3xl border flex justify-between items-center shadow-sm">
                                    <div>
                                        <div class="text-red-600 font-black text-xs uppercase italic leading-none">Poste ${f.posteJ1}</div>
                                        <div class="font-black text-blue-900 uppercase text-lg italic">${f.nom} ${f.prenom}</div>
                                    </div>
                                    <button onclick="removePosteJ1('${f.nom}', '${f.prenom}')" class="text-red-200 hover:text-red-500 transition-colors">
                                        <i data-lucide="x-circle"></i>
                                    </button>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <!-- Grand √âtang -->
                    <div>
                        <h3 class="font-black text-emerald-600 uppercase mb-4 bg-emerald-50 p-4 rounded-xl text-xs italic tracking-widest flex items-center gap-2">
                            <span class="w-3 h-3 bg-emerald-600 rounded-full"></span> Grand √âtang (${etangAssigned.length}/7)
                        </h3>
                        <div class="space-y-3">
                            ${etangAssigned.sort((a,b) => a.posteJ1 - b.posteJ1).map(f => `
                                <div class="bg-white p-5 rounded-3xl border flex justify-between items-center shadow-sm">
                                    <div>
                                        <div class="text-emerald-600 font-black text-xs uppercase italic leading-none">Poste ${f.posteJ1}</div>
                                        <div class="font-black text-blue-900 uppercase text-lg italic">${f.nom} ${f.prenom}</div>
                                    </div>
                                    <button onclick="removePosteJ1('${f.nom}', '${f.prenom}')" class="text-red-200 hover:text-red-500 transition-colors">
                                        <i data-lucide="x-circle"></i>
                                    </button>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
                
                <!-- En attente -->
                <div class="bg-white p-8 rounded-[2.5rem] shadow-xl border">
                    <h3 class="font-black text-slate-600 uppercase mb-4 text-sm italic">En attente d'attribution (${waiting.length})</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        ${waiting.map(f => `
                            <div class="bg-slate-50 p-4 rounded-2xl border-2 border-dashed border-slate-200 flex justify-between items-center">
                                <div class="font-black text-blue-900 uppercase text-sm italic">${f.nom} ${f.prenom}</div>
                                <div class="flex gap-2">
                                    <button onclick="openModalJ1('${f.nom}', '${f.prenom}', 'carpodrome')" class="bg-red-600 text-white px-3 py-2 rounded-xl font-black text-[10px] uppercase italic">
                                        Carpo
                                    </button>
                                    <button onclick="openModalJ1('${f.nom}', '${f.prenom}', 'grand-etang')" class="bg-emerald-600 text-white px-3 py-2 rounded-xl font-black text-[10px] uppercase italic">
                                        √âtang
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        window.openModalJ1 = (nom, prenom, secteur) => {
            state.targetFisher = { nom, prenom };
            state.targetSecteur = secteur;
            state.targetDay = 1;
            
            document.getElementById('modal-fisher-name').innerText = `${nom} ${prenom}`;
            document.getElementById('modal-fisher-secteur').innerText = `Secteur: ${secteur === 'carpodrome' ? 'Carpodrome' : 'Grand √âtang'}`;
            
            const sel = document.getElementById('modal-select-poste');
            sel.innerHTML = '<option value="">Choisir un poste...</option>';
            
            for(let i = 1; i <= 7; i++) {
                if(!state.fishermen.find(f => f.posteJ1 == i && f.secteurJ1 === secteur)) {
                    sel.innerHTML += `<option value="${i}">Poste ${i}</option>`;
                }
            }
            
            document.getElementById('modal-poste').classList.remove('hidden');
        };

        window.removePosteJ1 = (nom, prenom) => {
            const f = state.fishermen.find(f => f.nom === nom && f.prenom === prenom);
            if(f) {
                f.secteurJ1 = null;
                f.posteJ1 = null;
                // Supprimer aussi J2 car il d√©pend de J1
                f.secteurJ2 = null;
                f.posteJ2 = null;
                save();
            }
        };

        // Attribution J2
        function renderAttributionJ2(container) {
            // J2: inversion automatique des secteurs
            const carpoJ2 = state.fishermen.filter(f => f.secteurJ1 === 'grand-etang'); // Ex Grand √âtang ‚Üí Carpodrome
            const etangJ2 = state.fishermen.filter(f => f.secteurJ1 === 'carpodrome'); // Ex Carpodrome ‚Üí Grand √âtang
            
            const carpoAssigned = carpoJ2.filter(f => f.posteJ2);
            const etangAssigned = etangJ2.filter(f => f.posteJ2);
            const carpoWaiting = carpoJ2.filter(f => !f.posteJ2);
            const etangWaiting = etangJ2.filter(f => !f.posteJ2);
            
            container.innerHTML = `
                <button onclick="nav('index')" class="mb-8 flex items-center text-blue-600 font-bold underline italic">
                    <i data-lucide="arrow-left" class="mr-2"></i> Retour Accueil
                </button>
                
                <div class="bg-white p-8 rounded-[2.5rem] shadow-xl border mb-8">
                    <h2 class="text-2xl font-black text-blue-900 uppercase mb-2 italic">Attribution Jour 2</h2>
                    <p class="text-slate-500 text-sm">${state.contestInfo.dateJ2} - Les secteurs sont invers√©s. Attribuez uniquement les postes.</p>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Carpodrome J2 (ex Grand √âtang J1) -->
                    <div>
                        <h3 class="font-black text-red-600 uppercase mb-4 bg-red-50 p-4 rounded-xl text-xs italic tracking-widest">
                            <span class="w-3 h-3 bg-red-600 rounded-full inline-block mr-2"></span> 
                            Carpodrome J2 <span class="text-red-300 font-normal">(ex Grand √âtang J1)</span>
                        </h3>
                        
                        <div class="space-y-3 mb-6">
                            ${carpoAssigned.sort((a,b) => a.posteJ2 - b.posteJ2).map(f => `
                                <div class="bg-white p-5 rounded-3xl border flex justify-between items-center shadow-sm">
                                    <div>
                                        <div class="text-red-600 font-black text-xs uppercase italic leading-none">Poste ${f.posteJ2}</div>
                                        <div class="font-black text-blue-900 uppercase text-lg italic">${f.nom} ${f.prenom}</div>
                                    </div>
                                    <button onclick="removePosteJ2('${f.nom}', '${f.prenom}')" class="text-red-200 hover:text-red-500 transition-colors">
                                        <i data-lucide="x-circle"></i>
                                    </button>
                                </div>
                            `).join('')}
                        </div>
                        
                        <!-- En attente Carpodrome J2 -->
                        ${carpoWaiting.length > 0 ? `
                            <div class="bg-red-50/50 p-4 rounded-2xl border border-dashed border-red-200">
                                <p class="text-xs text-red-400 font-bold mb-3 uppercase">En attente (${carpoWaiting.length})</p>
                                <div class="space-y-2">
                                    ${carpoWaiting.map(f => `
                                        <div class="bg-white p-3 rounded-xl flex justify-between items-center">
                                            <span class="font-bold text-blue-900 text-sm uppercase italic">${f.nom} ${f.prenom}</span>
                                            <button onclick="openModalJ2('${f.nom}', '${f.prenom}', 'carpodrome')" class="bg-red-600 text-white px-3 py-1 rounded-lg font-black text-[10px] uppercase">
                                                Assigner
                                            </button>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                    
                    <!-- Grand √âtang J2 (ex Carpodrome J1) -->
                    <div>
                        <h3 class="font-black text-emerald-600 uppercase mb-4 bg-emerald-50 p-4 rounded-xl text-xs italic tracking-widest">
                            <span class="w-3 h-3 bg-emerald-600 rounded-full inline-block mr-2"></span> 
                            Grand √âtang J2 <span class="text-emerald-300 font-normal">(ex Carpodrome J1)</span>
                        </h3>
                        
                        <div class="space-y-3 mb-6">
                            ${etangAssigned.sort((a,b) => a.posteJ2 - b.posteJ2).map(f => `
                                <div class="bg-white p-5 rounded-3xl border flex justify-between items-center shadow-sm">
                                    <div>
                                        <div class="text-emerald-600 font-black text-xs uppercase italic leading-none">Poste ${f.posteJ2}</div>
                                        <div class="font-black text-blue-900 uppercase text-lg italic">${f.nom} ${f.prenom}</div>
                                    </div>
                                    <button onclick="removePosteJ2('${f.nom}', '${f.prenom}')" class="text-red-200 hover:text-red-500 transition-colors">
                                        <i data-lucide="x-circle"></i>
                                    </button>
                                </div>
                            `).join('')}
                        </div>
                        
                        <!-- En attente Grand √âtang J2 -->
                        ${etangWaiting.length > 0 ? `
                            <div class="bg-emerald-50/50 p-4 rounded-2xl border border-dashed border-emerald-200">
                                <p class="text-xs text-emerald-400 font-bold mb-3 uppercase">En attente (${etangWaiting.length})</p>
                                <div class="space-y-2">
                                    ${etangWaiting.map(f => `
                                        <div class="bg-white p-3 rounded-xl flex justify-between items-center">
                                            <span class="font-bold text-blue-900 text-sm uppercase italic">${f.nom} ${f.prenom}</span>
                                            <button onclick="openModalJ2('${f.nom}', '${f.prenom}', 'grand-etang')" class="bg-emerald-600 text-white px-3 py-1 rounded-lg font-black text-[10px] uppercase">
                                                Assigner
                                            </button>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        window.openModalJ2 = (nom, prenom, secteur) => {
            state.targetFisher = { nom, prenom };
            state.targetSecteur = secteur;
            state.targetDay = 2;
            
            document.getElementById('modal-fisher-name').innerText = `${nom} ${prenom}`;
            document.getElementById('modal-fisher-secteur').innerText = `Secteur J2: ${secteur === 'carpodrome' ? 'Carpodrome' : 'Grand √âtang'}`;
            
            const sel = document.getElementById('modal-select-poste');
            sel.innerHTML = '<option value="">Choisir un poste...</option>';
            
            for(let i = 1; i <= 7; i++) {
                if(!state.fishermen.find(f => f.posteJ2 == i && f.secteurJ2 === secteur)) {
                    sel.innerHTML += `<option value="${i}">Poste ${i}</option>`;
                }
            }
            
            document.getElementById('modal-poste').classList.remove('hidden');
        };

        window.removePosteJ2 = (nom, prenom) => {
            const f = state.fishermen.find(f => f.nom === nom && f.prenom === prenom);
            if(f) {
                f.posteJ2 = null;
                save();
            }
        };

        // Confirmation attribution poste
        window.confirmPosteAssignment = () => {
            const poste = parseInt(document.getElementById('modal-select-poste').value);
            if(!poste) return;
            
            const f = state.fishermen.find(f => f.nom === state.targetFisher.nom && f.prenom === state.targetFisher.prenom);
            if(!f) return;
            
            if(state.targetDay === 1) {
                f.secteurJ1 = state.targetSecteur;
                f.posteJ1 = poste;
                // Pr√©-d√©finir le secteur J2 (invers√©)
                f.secteurJ2 = state.targetSecteur === 'carpodrome' ? 'grand-etang' : 'carpodrome';
            } else {
                f.secteurJ2 = state.targetSecteur;
                f.posteJ2 = poste;
            }
            
            save();
            closePosteModal();
        };

        window.closePosteModal = () => {
            document.getElementById('modal-poste').classList.add('hidden');
        };

        // Page Poste (Pes√©es)
        function renderPoste(container) {
            const posteKey = state.currentDay === 1 ? 'posteJ1' : 'posteJ2';
            const secteurKey = state.currentDay === 1 ? 'secteurJ1' : 'secteurJ2';
            
            const f = state.fishermen.find(f => f[posteKey] == state.currentPoste && f[secteurKey] === state.currentSecteur);
            if(!f) return nav('index');
            
            const dayWeights = (f.weights || []).filter(w => w.day === state.currentDay);
            const dayTotal = calc.dayWeight(f, state.currentDay);
            
            const secteurColor = state.currentSecteur === 'carpodrome' ? 'red' : 'emerald';
            const secteurName = state.currentSecteur === 'carpodrome' ? 'Carpodrome' : 'Grand √âtang';
            
            container.innerHTML = `
                <button onclick="nav('index')" class="mb-8 flex items-center text-blue-600 font-bold underline italic">
                    <i data-lucide="arrow-left" class="mr-2"></i> Retour
                </button>
                
                <div class="bg-white p-8 rounded-[2.5rem] shadow-xl border-l-8 border-${secteurColor}-600 mb-6 flex justify-between items-end">
                    <div>
                        <div class="text-xs font-bold text-${secteurColor}-600 uppercase mb-1">${secteurName} - Jour ${state.currentDay}</div>
                        <h1 class="text-4xl font-black text-blue-900 uppercase italic">Poste ${state.currentPoste}</h1>
                        <p class="text-2xl font-bold text-slate-400 uppercase leading-none italic">${f.nom} ${f.prenom}</p>
                    </div>
                    <div class="bg-${secteurColor}-50 p-6 rounded-[2rem] text-right border border-${secteurColor}-100 shadow-inner">
                        <span class="text-4xl font-black text-${secteurColor}-800">${dayTotal.toFixed(3)}<span class="text-lg ml-1">kg</span></span>
                        <div class="text-[10px] text-${secteurColor}-400 font-bold uppercase mt-1">Total Jour ${state.currentDay}</div>
                    </div>
                </div>
                
                <div class="bg-white p-8 rounded-[2.5rem] shadow-sm border mb-8 grid grid-cols-1 sm:grid-cols-4 gap-4">
                    <input id="p_wei" type="number" step="0.001" placeholder="Poids (kg)" class="p-4 border-2 border-slate-100 rounded-2xl font-bold bg-slate-50 outline-none focus:border-blue-600">
                    <input id="p_cou" type="number" value="1" placeholder="Nb Poissons" class="p-4 border-2 border-slate-100 rounded-2xl font-bold bg-slate-50 outline-none focus:border-blue-600">
                    <select id="p_per" class="p-4 border-2 border-slate-100 rounded-2xl font-bold bg-slate-50 uppercase outline-none">
                        <option value="matin">Matin</option>
                        <option value="apres-midi">Apr√®s-midi</option>
                    </select>
                    <button onclick="addW()" class="bg-${secteurColor}-600 text-white font-black py-4 rounded-2xl shadow-lg uppercase italic tracking-widest">
                        Valider
                    </button>
                </div>
                
                <div class="bg-white rounded-[2.5rem] shadow-sm border overflow-hidden">
                    <table class="w-full text-left">
                        <thead class="bg-slate-50 text-slate-400 font-black uppercase text-[10px] tracking-widest">
                            <tr>
                                <th class="p-6">P√©riode</th>
                                <th class="p-6">Poissons</th>
                                <th class="p-6 text-right">Poids</th>
                                <th class="p-6"></th>
                            </tr>
                        </thead>
                        <tbody>
                            ${dayWeights.slice().reverse().map((w, idx) => {
                                const realIdx = f.weights.indexOf(dayWeights[dayWeights.length - 1 - idx]);
                                return `
                                    <tr class="border-t border-slate-50 hover:bg-slate-50/50">
                                        <td class="p-6 font-bold text-blue-900 uppercase text-xs italic">${w.period}</td>
                                        <td class="p-6 font-bold text-blue-400 text-sm italic">${w.fishCount || 0} Poisson(s)</td>
                                        <td class="p-6 text-right font-black text-blue-900 text-xl italic">${w.weight.toFixed(3)} kg</td>
                                        <td class="p-6 flex justify-center gap-2">
                                            <button onclick="editW(${realIdx})" class="p-2 text-blue-200 hover:text-blue-600 transition-colors">
                                                <i data-lucide="edit-3"></i>
                                            </button>
                                            <button onclick="delW(${realIdx})" class="p-2 text-red-200 hover:text-red-500 transition-colors">
                                                <i data-lucide="trash-2"></i>
                                            </button>
                                        </td>
                                    </tr>`;
                            }).join('')}
                        </tbody>
                    </table>
                    ${dayWeights.length === 0 ? '<p class="p-8 text-center text-slate-300 italic">Aucune pes√©e enregistr√©e</p>' : ''}
                </div>
            `;
        }

        window.addW = () => {
            const posteKey = state.currentDay === 1 ? 'posteJ1' : 'posteJ2';
            const secteurKey = state.currentDay === 1 ? 'secteurJ1' : 'secteurJ2';
            
            const f = state.fishermen.find(f => f[posteKey] == state.currentPoste && f[secteurKey] === state.currentSecteur);
            if(!f) return;
            
            const w = parseFloat(document.getElementById('p_wei').value);
            const c = parseInt(document.getElementById('p_cou').value) || 1;
            const p = document.getElementById('p_per').value;
            
            if(!w || w <= 0) return alert("Veuillez entrer un poids valide");
            
            f.weights.push({ 
                day: state.currentDay,
                period: p, 
                weight: w, 
                fishCount: c 
            });
            save();
            
            document.getElementById('p_wei').value = '';
            document.getElementById('p_cou').value = '1';
        };

        window.editW = (idx) => {
            const pwd = prompt("Modification r√©serv√©e. Mot de passe admin :");
            if(pwd !== "admin") return alert("Acc√®s refus√©");
            
            const posteKey = state.currentDay === 1 ? 'posteJ1' : 'posteJ2';
            const secteurKey = state.currentDay === 1 ? 'secteurJ1' : 'secteurJ2';
            
            const f = state.fishermen.find(f => f[posteKey] == state.currentPoste && f[secteurKey] === state.currentSecteur);
            if(!f) return;
            
            const w = f.weights[idx];
            document.getElementById('p_per').value = w.period;
            document.getElementById('p_wei').value = w.weight;
            document.getElementById('p_cou').value = w.fishCount;
            
            f.weights.splice(idx, 1);
            save();
            alert("Donn√©es remont√©es dans le formulaire. Modifiez puis cliquez sur Valider.");
        };

        window.delW = (idx) => {
            const pwd = prompt("Suppression r√©serv√©e. Mot de passe admin :");
            if(pwd !== "admin") return alert("Acc√®s refus√©");
            
            const posteKey = state.currentDay === 1 ? 'posteJ1' : 'posteJ2';
            const secteurKey = state.currentDay === 1 ? 'secteurJ1' : 'secteurJ2';
            
            const f = state.fishermen.find(f => f[posteKey] == state.currentPoste && f[secteurKey] === state.currentSecteur);
            if(!f) return;
            
            f.weights.splice(idx, 1);
            save();
        };

        // R√©sultats
        function renderResultats(container) {
            container.innerHTML = `
                <button onclick="nav('index')" class="mb-8 flex items-center text-blue-600 font-bold underline italic">
                    <i data-lucide="arrow-left" class="mr-2"></i> Retour Accueil
                </button>
                
                <!-- Onglets r√©sultats -->
                <div class="flex gap-4 mb-8 flex-wrap">
                    <button onclick="showResult('j1')" id="btn-j1" class="px-6 py-3 rounded-2xl font-black uppercase italic transition-all bg-blue-900 text-white">
                        Jour 1
                    </button>
                    <button onclick="showResult('j2')" id="btn-j2" class="px-6 py-3 rounded-2xl font-black uppercase italic transition-all bg-white text-blue-900 border-2 border-blue-200">
                        Jour 2
                    </button>
                    <button onclick="showResult('general')" id="btn-general" class="px-6 py-3 rounded-2xl font-black uppercase italic transition-all bg-white text-blue-900 border-2 border-blue-200">
                        üèÜ G√©n√©ral
                    </button>
                </div>
                
                <div id="result-j1">${renderResultDay(1)}</div>
                <div id="result-j2" class="hidden">${renderResultDay(2)}</div>
                <div id="result-general" class="hidden">${renderResultGeneral()}</div>
            `;
        }

        window.showResult = (tab) => {
            ['j1', 'j2', 'general'].forEach(t => {
                document.getElementById(`result-${t}`).classList.toggle('hidden', t !== tab);
                document.getElementById(`btn-${t}`).classList.toggle('bg-blue-900', t === tab);
                document.getElementById(`btn-${t}`).classList.toggle('text-white', t === tab);
                document.getElementById(`btn-${t}`).classList.toggle('bg-white', t !== tab);
                document.getElementById(`btn-${t}`).classList.toggle('text-blue-900', t !== tab);
                document.getElementById(`btn-${t}`).classList.toggle('border-2', t !== tab);
                document.getElementById(`btn-${t}`).classList.toggle('border-blue-200', t !== tab);
            });
        };

        function renderResultDay(day) {
            const posteKey = day === 1 ? 'posteJ1' : 'posteJ2';
            const secteurKey = day === 1 ? 'secteurJ1' : 'secteurJ2';
            const dateStr = day === 1 ? state.contestInfo.dateJ1 : state.contestInfo.dateJ2;
            
            const sorted = [...state.fishermen]
                .filter(f => f[posteKey])
                .sort((a, b) => calc.dayWeight(b, day) - calc.dayWeight(a, day));
            
            const rec = calc.dayRecord(day);
            
            return `
                <div class="mb-8">
                    <h2 class="text-3xl font-black text-blue-900 uppercase italic mb-8 border-l-8 border-blue-600 pl-4">
                        Classement Jour ${day} <span class="text-lg font-normal text-slate-400">${dateStr}</span>
                    </h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div class="bg-blue-900 p-8 rounded-[2.5rem] text-white shadow-xl">
                            <p class="text-xs font-black uppercase mb-1 opacity-60 italic">Poids Total</p>
                            <p class="text-4xl font-black">${calc.globalDayWeight(day).toFixed(3)} kg</p>
                        </div>
                        <div class="bg-blue-600 p-8 rounded-[2.5rem] text-white shadow-xl">
                            <p class="text-xs font-black uppercase mb-1 opacity-60 italic">Poissons Sortis</p>
                            <p class="text-4xl font-black">${calc.globalDayFish(day)}</p>
                        </div>
                        <div class="bg-yellow-500 p-8 rounded-[2.5rem] text-blue-900 shadow-xl">
                            <p class="text-xs font-black uppercase mb-1 opacity-60 italic">Plus Grosse Prise</p>
                            <p class="text-3xl font-black">${rec.w.toFixed(3)} kg</p>
                            <p class="text-[10px] font-black uppercase italic mt-1">${rec.n} ${rec.p}</p>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-[2.5rem] shadow-xl border overflow-hidden">
                        <table class="w-full text-left">
                            <thead class="bg-blue-900 text-white text-[10px] uppercase font-black tracking-widest">
                                <tr>
                                    <th class="p-6">Rang</th>
                                    <th class="p-6">Secteur</th>
                                    <th class="p-6">Poste</th>
                                    <th class="p-6">Identit√©</th>
                                    <th class="p-6 text-right">Poids</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${sorted.map((f, i) => {
                                    const secteurColor = f[secteurKey] === 'carpodrome' ? 'red' : 'emerald';
                                    const secteurName = f[secteurKey] === 'carpodrome' ? 'Carpo' : '√âtang';
                                    return `
                                        <tr class="border-b border-slate-50 last:border-0 hover:bg-blue-50/50">
                                            <td class="p-6">
                                                <span class="w-12 h-12 flex items-center justify-center rounded-2xl font-black text-xl ${i===0?'bg-yellow-400 text-white shadow-lg':i===1?'bg-slate-300 text-white':i===2?'bg-orange-400 text-white':'bg-slate-100 text-slate-400'}">
                                                    ${i+1}
                                                </span>
                                            </td>
                                            <td class="p-6">
                                                <span class="bg-${secteurColor}-100 text-${secteurColor}-600 px-3 py-1 rounded-full text-xs font-bold uppercase">${secteurName}</span>
                                            </td>
                                            <td class="p-6 font-black text-blue-600 text-xl italic">${f[posteKey]}</td>
                                            <td class="p-6">
                                                <div class="font-black text-blue-900 uppercase text-lg leading-none italic">${f.nom}</div>
                                                <div class="text-[10px] font-bold text-slate-400 mt-1 uppercase italic">${f.prenom}</div>
                                            </td>
                                            <td class="p-6 text-right font-black text-2xl text-blue-900 tracking-tighter">${calc.dayWeight(f, day).toFixed(3)} kg</td>
                                        </tr>`;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        function renderResultGeneral() {
            const sorted = [...state.fishermen]
                .filter(f => f.posteJ1 || f.posteJ2)
                .sort((a, b) => calc.totalWeight(b) - calc.totalWeight(a));
            
            const rec = calc.globalRecord();
            const totalPoids = state.fishermen.reduce((acc, f) => acc + calc.totalWeight(f), 0);
            const totalPoissons = state.fishermen.reduce((acc, f) => acc + calc.totalFishCount(f), 0);
            
            return `
                <div class="mb-8">
                    <h2 class="text-3xl font-black text-blue-900 uppercase italic mb-8 border-l-8 border-yellow-500 pl-4">
                        üèÜ Classement G√©n√©ral <span class="text-lg font-normal text-slate-400">Cumul 2 Jours</span>
                    </h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div class="bg-gradient-to-br from-blue-900 to-blue-700 p-8 rounded-[2.5rem] text-white shadow-xl">
                            <p class="text-xs font-black uppercase mb-1 opacity-60 italic">Poids Total 2 Jours</p>
                            <p class="text-4xl font-black">${totalPoids.toFixed(3)} kg</p>
                        </div>
                        <div class="bg-gradient-to-br from-blue-600 to-blue-400 p-8 rounded-[2.5rem] text-white shadow-xl">
                            <p class="text-xs font-black uppercase mb-1 opacity-60 italic">Poissons Total</p>
                            <p class="text-4xl font-black">${totalPoissons}</p>
                        </div>
                        <div class="bg-gradient-to-br from-yellow-500 to-yellow-400 p-8 rounded-[2.5rem] text-blue-900 shadow-xl">
                            <p class="text-xs font-black uppercase mb-1 opacity-60 italic">Record du Concours</p>
                            <p class="text-3xl font-black">${rec.w.toFixed(3)} kg</p>
                            <p class="text-[10px] font-black uppercase italic mt-1">${rec.n} ${rec.p}</p>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-[2.5rem] shadow-xl border overflow-hidden">
                        <table class="w-full text-left">
                            <thead class="bg-gradient-to-r from-yellow-500 to-yellow-400 text-blue-900 text-[10px] uppercase font-black tracking-widest">
                                <tr>
                                    <th class="p-6">Rang</th>
                                    <th class="p-6">Identit√©</th>
                                    <th class="p-6 text-center">Jour 1</th>
                                    <th class="p-6 text-center">Jour 2</th>
                                    <th class="p-6 text-right">Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${sorted.map((f, i) => `
                                    <tr class="border-b border-slate-50 last:border-0 hover:bg-yellow-50/50">
                                        <td class="p-6">
                                            <span class="w-14 h-14 flex items-center justify-center rounded-2xl font-black text-2xl ${i===0?'bg-yellow-400 text-white shadow-lg':i===1?'bg-slate-300 text-white':i===2?'bg-orange-400 text-white':'bg-slate-100 text-slate-400'}">
                                                ${i+1}
                                            </span>
                                        </td>
                                        <td class="p-6">
                                            <div class="font-black text-blue-900 uppercase text-xl leading-none italic">${f.nom}</div>
                                            <div class="text-xs font-bold text-slate-400 mt-1 uppercase italic">${f.prenom}</div>
                                        </td>
                                        <td class="p-6 text-center">
                                            <div class="font-bold text-slate-600">${calc.dayWeight(f, 1).toFixed(3)} kg</div>
                                            <div class="text-[9px] text-slate-400">${f.secteurJ1 === 'carpodrome' ? 'Carpo' : '√âtang'} P${f.posteJ1 || '-'}</div>
                                        </td>
                                        <td class="p-6 text-center">
                                            <div class="font-bold text-slate-600">${calc.dayWeight(f, 2).toFixed(3)} kg</div>
                                            <div class="text-[9px] text-slate-400">${f.secteurJ2 === 'carpodrome' ? 'Carpo' : '√âtang'} P${f.posteJ2 || '-'}</div>
                                        </td>
                                        <td class="p-6 text-right font-black text-3xl text-blue-900 tracking-tighter">${calc.totalWeight(f).toFixed(3)} kg</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        // Param√®tres Admin
        function renderSettings(container) {
            container.innerHTML = `
                <button onclick="nav('index')" class="mb-8 flex items-center text-blue-600 font-bold underline italic">
                    <i data-lucide="arrow-left" class="mr-2"></i> Retour
                </button>
                
                <div class="bg-white p-10 rounded-[2.5rem] shadow-xl border max-w-lg mx-auto">
                    <h2 class="text-2xl font-black text-blue-900 mb-8 uppercase italic">Param√®tres Admin</h2>
                    
                    <div class="space-y-6">
                        <div>
                            <label class="text-[10px] font-black uppercase text-slate-400 ml-2">Titre du Concours</label>
                            <input id="set_title" value="${state.contestInfo.title}" class="w-full p-4 border rounded-2xl font-bold bg-slate-50 outline-none">
                        </div>
                        <div>
                            <label class="text-[10px] font-black uppercase text-slate-400 ml-2">Date Jour 1</label>
                            <input id="set_dateJ1" value="${state.contestInfo.dateJ1}" class="w-full p-4 border rounded-2xl font-bold bg-slate-50 outline-none">
                        </div>
                        <div>
                            <label class="text-[10px] font-black uppercase text-slate-400 ml-2">Date Jour 2</label>
                            <input id="set_dateJ2" value="${state.contestInfo.dateJ2}" class="w-full p-4 border rounded-2xl font-bold bg-slate-50 outline-none">
                        </div>
                        
                        <button onclick="updateSet()" class="w-full bg-blue-600 text-white font-black py-4 rounded-2xl shadow-xl uppercase italic">
                            Enregistrer
                        </button>
                        
                        <hr class="my-6">
                        
                        <button onclick="resetJ1()" class="w-full bg-orange-50 text-orange-600 font-bold py-4 rounded-2xl italic">
                            R√©initialiser Jour 1 (postes + pes√©es)
                        </button>
                        <button onclick="resetJ2()" class="w-full bg-orange-50 text-orange-600 font-bold py-4 rounded-2xl italic">
                            R√©initialiser Jour 2 (postes + pes√©es)
                        </button>
                        <button onclick="resetAll()" class="w-full bg-red-50 text-red-600 font-bold py-4 rounded-2xl italic">
                            üóëÔ∏è Tout supprimer (‚ö†Ô∏è irr√©versible)
                        </button>
                    </div>
                </div>
            `;
        }

        window.updateSet = () => {
            state.contestInfo.title = document.getElementById('set_title').value;
            state.contestInfo.dateJ1 = document.getElementById('set_dateJ1').value;
            state.contestInfo.dateJ2 = document.getElementById('set_dateJ2').value;
            save();
            nav('index');
        };

        window.resetJ1 = () => {
            if(!confirm("R√©initialiser les postes et pes√©es du Jour 1 ?")) return;
            state.fishermen.forEach(f => {
                f.secteurJ1 = null;
                f.posteJ1 = null;
                f.secteurJ2 = null;
                f.posteJ2 = null;
                f.weights = f.weights.filter(w => w.day !== 1);
            });
            save();
            alert("Jour 1 r√©initialis√©");
        };

        window.resetJ2 = () => {
            if(!confirm("R√©initialiser les postes et pes√©es du Jour 2 ?")) return;
            state.fishermen.forEach(f => {
                f.posteJ2 = null;
                f.weights = f.weights.filter(w => w.day !== 2);
            });
            save();
            alert("Jour 2 r√©initialis√©");
        };

        window.resetAll = () => {
            if(!confirm("Supprimer TOUTES les donn√©es du concours ? Cette action est irr√©versible.")) return;
            if(!confirm("√ätes-vous vraiment s√ªr ?")) return;
            state.fishermen = [];
            save();
            nav('index');
        };

        // D√©marrage
        render();
    </script>
</body>
</html>
